---
- hosts: localhost
  vars:
    source_path: /var/www
  tasks:
    - name: install node and npm
      become: true
      apt:
        name: "{{ item }}"
        state: present
      loop:
        - nodejs
        - npm
        - nginx

    - name: install npm packages
      npm:
        name: "{{ item }}"
        global: yes
      loop:
        - express
        - pm2

    - name: make {{ source_path }} directory
      become: true
      file:
        path: "{{ source_path }}"
        state: directory

    - name: copy source to /var/www
      become: true
      copy:
        src: /tmp/ighestates-master/dist/ighestates
        dest: "{{ source_path }}"
